<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Instructor Dashboard</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.socket.io/4.0.1/socket.io.min.js"></script>
</head>
<body class="transition-colors duration-300 bg-gray-100 dark:bg-gray-900 text-gray-900 dark:text-gray-100 font-sans p-6 min-h-screen">

  <!-- üåó Theme Toggle -->
  <div class="fixed top-4 right-6 z-50">
    <button onclick="toggleTheme()" class="bg-gray-300 dark:bg-gray-800 text-black dark:text-white px-4 py-2 rounded-lg shadow hover:bg-gray-400 dark:hover:bg-gray-700 transition">
      Toggle üåô/‚òÄÔ∏è
    </button>
  </div>

  <!-- üìã Main Container -->
  <div class="max-w-5xl mx-auto bg-white dark:bg-gray-800 shadow-xl rounded-lg p-8 mt-10">
    <h1 class="text-4xl font-bold text-blue-700 dark:text-blue-300 mb-6 text-center">Instructor Dashboard</h1>

    <!-- üß™ Quiz Form -->
    <form id="quiz-form" class="space-y-6">
      <h2 class="text-2xl font-semibold text-gray-700 dark:text-gray-200">Create MCQ Quiz</h2>
      <div id="questions" class="space-y-4"></div>

      <button type="button" onclick="addQuestion()"
        class="bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600 transition">
        + Add Another Question
      </button>

      <div class="mt-4">
        <label for="timer" class="font-medium text-gray-700 dark:text-gray-300">Timer (seconds):</label>
        <input type="number" id="timer" value="60"
          class="ml-2 p-2 border border-gray-300 dark:border-gray-600 rounded-md w-24 bg-white dark:bg-gray-700 text-black dark:text-white" />
      </div>

      <button type="submit"
        class="mt-4 bg-green-600 text-white px-6 py-2 rounded-lg hover:bg-green-700 transition">
        Send Quiz to Students
      </button>
    </form>

    <!-- üì• Download CSV -->
    <div class="mt-8">
      <button onclick="window.location.href='/download_csv'"
        class="bg-purple-500 text-white px-4 py-2 rounded-lg hover:bg-purple-600 transition">
        üì• Download Submissions CSV
      </button>
    </div>

    <!-- üìä Live Submissions -->
    <div class="mt-10">
      <h2 class="text-2xl font-semibold text-gray-700 dark:text-gray-200 mb-4">Live Submissions</h2>
      <div id="submissions"
        class="bg-gray-50 dark:bg-gray-700 p-4 rounded-lg border border-gray-300 dark:border-gray-600 text-gray-800 dark:text-white">
        No submissions yet.
      </div>
    </div>
  </div>

  <!-- ‚öôÔ∏è JavaScript Logic -->
  <script>
    const socket = io();

    function addQuestion() {
      const block = document.createElement('div');
      block.classList.add(
        'p-4', 'bg-blue-50', 'dark:bg-gray-700', 'rounded-lg', 'border', 'border-blue-200', 'dark:border-gray-600', 'space-y-2'
      );
      block.innerHTML = `
        <input type="text" name="question" placeholder="Enter Question"
               class="w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-800 text-black dark:text-white" required><br>
        <input type="text" name="option1" placeholder="Option 1"
               class="w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-800 text-black dark:text-white" required><br>
        <input type="text" name="option2" placeholder="Option 2"
               class="w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-800 text-black dark:text-white" required><br>
        <input type="text" name="option3" placeholder="Option 3"
               class="w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-800 text-black dark:text-white" required><br>
        <input type="text" name="option4" placeholder="Option 4"
               class="w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-800 text-black dark:text-white" required><br>
        <input type="text" name="correct" placeholder="Correct Option Text"
               class="w-full p-2 border border-green-400 dark:border-green-300 rounded-md bg-white dark:bg-gray-800 text-black dark:text-white" required>
      `;
      document.getElementById('questions').appendChild(block);
    }

    document.getElementById('quiz-form').addEventListener('submit', function (e) {
      e.preventDefault();
      const questionBlocks = document.querySelectorAll('#questions .p-4');
      let questions = [];

      questionBlocks.forEach(block => {
        const inputs = block.querySelectorAll('input');
        const q = {
          question: inputs[0].value,
          options: [inputs[1].value, inputs[2].value, inputs[3].value, inputs[4].value],
          correct: inputs[5].value
        };
        questions.push(q);
      });

      const timer = parseInt(document.getElementById('timer').value);
      socket.emit('send_quiz', { questions: questions, timer: timer });

      document.getElementById('questions').innerHTML = '';
      addQuestion();
    });

    socket.on('update_submissions', function (data) {
      const submissionsDiv = document.getElementById('submissions');
      submissionsDiv.innerHTML = '';
      
      if (Object.keys(data).length === 0) {
        submissionsDiv.innerHTML = 'No submissions yet.';
        return;
      }
      
      for (const student in data) {
        const sub = data[student];
        submissionsDiv.innerHTML += `
          <div class="mb-2 p-2 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-600 rounded-lg">
            <strong>${student}</strong> - Score: <span class="text-green-700 dark:text-green-300">${sub.score}/${Object.keys(sub.answers).length}</span>
          </div>`;
      }
    });

    // üåó Theme Toggle Logic
    function toggleTheme() {
      const html = document.documentElement;
      html.classList.toggle('dark');
      localStorage.setItem('theme', html.classList.contains('dark') ? 'dark' : 'light');
    }

    // Load saved theme or system preference
    function loadTheme() {
      const savedTheme = localStorage.getItem('theme');
      const systemPrefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
      
      if (savedTheme === 'dark' || (!savedTheme && systemPrefersDark)) {
        document.documentElement.classList.add('dark');
      } else {
        document.documentElement.classList.remove('dark');
      }
    }

    // Initialize
    window.addEventListener('DOMContentLoaded', () => {
      loadTheme();
      addQuestion();
    });
  </script>
</body>
</html>